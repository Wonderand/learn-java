package chat;import com.alibaba.xingchen.ApiClient;import com.alibaba.xingchen.ApiException;import com.alibaba.xingchen.api.ChatApiSub;import com.alibaba.xingchen.auth.HttpBearerAuth;import com.alibaba.xingchen.model.*;import com.alibaba.xingchen.model.ext.chat.ChatContext;import io.reactivex.Flowable;import java.util.Arrays;/** * @Classname ChatApiSseExample * @Pakage: chat * @Author: hzr * @Description TODO * @Date 2024/3/26 11:26 * @Created by 22906 * @Version 1.0.0 */public class ChatApiSseExample {    public static void main(String[] args) throws ApiException {        ChatApiSub api = new ChatApiSub();        ApiClient apiClient = new ApiClient();        apiClient.setBasePath("https://nlp.aliyuncs.com");        apiClient.addDefaultHeader("X-DashScope-SSE", "enable"); // 开启SSE输出        // Configure HTTP bearer authorization: Authorization        HttpBearerAuth authorization = (HttpBearerAuth) apiClient.getAuthentication("Authorization");        authorization.setBearerToken("{lm-JVm+2MrmxdDKjtNntFMcSg==}");        api.setApiClient(apiClient);        Flowable<ChatResult> response = api.streamOut(buildChatReqParams());        response.blockingForEach(message -> {            System.out.println(message.getChoices().get(0).getMessages().get(0).getContent());        });    }    private static ChatReqParams buildChatReqParams() {        return ChatReqParams.builder()                .botProfile(                        CharacterKey.builder()                                // 星尘预制角色                                .characterId("40f70d5466e1429ba9aa755842b35d9f")                                .name("小婉")                                .build()                )                .modelParameters(                        ModelParameters.builder()                                .seed(1683806810L)                                .incrementalOutput(false)                                .build()                )                .userProfile(                        UserProfile.builder()                                .userId("1234")                                .build()                )                .messages(                        Arrays.asList(                                Message.builder()                                        .name("小明")                                        .content("你叫什么名字?")                                        .role("user")                                        .build(),                                Message.builder()                                        .name("小婉")                                        .content("我叫小婉啊。")                                        .role("assistant")                                        .build(),                                Message.builder()                                        .name("小明")                                        .content("你今年多大?")                                        .role("user")                                        .build(),                                Message.builder()                                        .name("小婉")                                        .content("我今年17岁了。")                                        .role("assistant")                                        .build(),                                // 注意，自定义角色 prompt，用户问题需放到messages最后一条                                Message.builder()                                        .name("小明")                                        .content("你今年多大?")                                        .role("user")                                        .build()                        )                )                .context(                        ChatContext.builder()                                .useChatHistory(false)                                .build()                )                .build();    }}